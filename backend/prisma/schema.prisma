generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Stage {
  id       Int     @id @default(autoincrement())
  length   Float   @default(0)

  start    Station @relation(name: "start_stages", fields: [start_id], references: [id])
  start_id Int

  end      Station @relation(name: "end_stages", fields: [end_id], references: [id])
  end_id   Int

}

model Station {
  id                 Int      @id @default(autoincrement())
  name               String?
  latitude           Float
  longitude          Float

  start_stages       Stage[]  @relation(name: "start_stages")
  end_stages         Stage[]  @relation(name: "end_stages")

  start_trains       Train[]  @relation(name: "start_station")
  end_trains         Train[]  @relation(name: "end_station")

  wagons_last        Wagon[] @relation(name: "wagon_last")
  wagons_destination Wagon[] @relation(name: "wagon_destination")

  @@map("StationCoordinates")
}

model Train {
  id       Int      @id @default(autoincrement())
  
  start    Station  @relation(name: "start_station", fields: [start_id], references: [id])
  start_id Int

  end      Station  @relation(name: "end_station", fields: [end_id], references: [id])
  end_id   Int
  
  wagons   Wagon[]
}

model Wagon {
  id                   Int      @id @default(autoincrement())
  train_id             Int
  train                Train    @relation(fields: [train_id], references: [id])

  operation_date       DateTime

  last_station         Station  @relation(name: "wagon_last", fields: [last_station_id], references: [id])
  last_station_id      Int

  wagon_destination    Station  @relation(name: "wagon_destination", fields: [wagon_destination_id], references: [id])
  wagon_destination_id Int
}
